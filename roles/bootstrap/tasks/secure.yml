---
- name: Install fail2ban
  action: apt pkg=fail2ban state=installed

- name: Configure fail2ban to listen to systemd journal
  template:
    dest: /etc/fail2ban/jail.d/sshd.conf

- name: Disallow password authentication
  action: lineinfile dest=/etc/ssh/sshd_config regexp="^PasswordAuthentication" line="PasswordAuthentication no" state=present
  notify: restart ssh

- name: Disallow root SSH access
  action: lineinfile dest=/etc/ssh/sshd_config regexp="^PermitRootLogin" line="PermitRootLogin no" state=present
  notify: restart ssh

- name: Install packages
  action: apt pkg=ufw state=installed

- name: Setup ufw 22/tcp
  action: shell ufw allow 22/tcp

- name: Setup ufw 80/tcp
  action: shell ufw allow 80/tcp

- name: Setup ufw 443/tcp
  action: shell ufw allow 443/tcp

- name: Enable ufw
  action: shell echo 'y' | ufw enable

- name: Delete root password
  action: shell passwd -d root
